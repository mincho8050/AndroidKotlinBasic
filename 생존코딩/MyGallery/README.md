



# MyGallery

난이도 : ★★☆

기능 : 기기에 저장된 사진을 차례대로 보여준다. 3초마다 자동으로 슬라이드 된다.

핵심 구성요소

- Content Provider : 사진 정보를 얻을 때 사용한다.
- Fragment : UI의 일부를 나타낸다.
- ViewPager : 프래그먼트 여러 개를 좌우로 슬라이드하여 넘길 수 있도록 해준다.
- FragmentStatePagerAdapter : 페이지가 많을 때 유용한 뷰페이저(ViewPager)용 어댑터.
- timer : 일정 시간 간격으로 반복되는 동작을 할 ㅜㅅ 있다.

라이브러리 설정

- Anko : 인텐트, 다이얼로그, 로그 등을 구현하는 데 도움이 되는 라이브러리
- Glide : 사진 로딩에 특화된 라이브러리로 메모리 절약과 자연스러운 사진 로딩에 사용





## 0) 해법요약

여러 사진이 좌우로 슬라이드되고 3초마다 자동으로 슬라이드되는 전자액자 앱을 만든다. 사진은 프래그먼트라는 UI조각으로 구성하고 프래그먼트들을 좌우로 슬라이드할 수 있게 뷰페이저(ViewPager)를 사용한다. 사진로딩에 Glide 라이브러리를 사용한다. 그리고 timer를 사용해 자동으로 슬라이드 되게 한다.

구현순서

1. 준비하기 : 프로젝트 생성 및  안드로이드 설정
2. 스텝 1 : 프로바이더 사용하기
3. 스텝 2 : 전자액자 구현하기
4. 스텝 3 : 슬라이드쇼 구현하기





## 1) 프로바이더 사용하기

사진을 찍으면 내부 저장소에 저장되고 안드로이드의 미디어 데이터베이스에도 사진 정보가 저장된다. 저장된 미디어 데이터는 콘텐츠 프로바이더(Contents Provider)를 사용해 다른 앱에 공개될 수 있다. 콘텐츠 프로바이더란 앱의 데이터 접근을 다른 앱에 허용하는 컴포넌트이다. 

프로바이더를 이용하여 사진 정보를 가지고 오는 순서

1. 사진 데이터는 외부 저장소에 저장되어 있으므로 외부 저장소 읽기 권한을 앱에 부여한다.
2. 외부 저장소 읽기 권한은 위험 권한으로 실행 중에 사용자에게 권한을 허용하도록 한다.
3. contentResolver 객체를 이용하여 데이터를 Cursor 객체로 가지고 온다.

그 다음 과정을 진행한다.

1. 프로바이더로 기기의 사진 경로 얻기
2. 매니페스트에 외부 저장소 읽기 권한 추가
3. 권한 확인
4. 권한 요청
5. 사용 권한 요청 응답 처리
6. 앱 실행



**안드로이드 4대 컴포넌트**

```
안드로이드에는 크게 4개의 중요 컴포넌트가 있다. 이를 4대 컴포넌트라고 지칭한다.
 - 액티비티 : 화면을 구성한다.
 - 콘텐츠 프로바이더 : 데이터베이스, 파일, 네트워크의 데이터를 다른 앱에 공유한다.
 - 브로드캐스트 리시버 : 앱이나 기기가 발송하는 방송을 수신한다.
 - 서비스 : 화면이 없고 백그라운드 작업에 용이하다.
```

**안드로이드 저장소**

```
안드로이드 저장소는 크게 두 가지 영역으로 나뉜다.
 - 내부 저장소 : OS가 설치된 영역으로 유저가 접근할 수 없는 시스템 영역이다. 앱이 사용하는 정보와 데이터베이스가 저장된다.
 - 외부 저장소 : 컴퓨터에 기기를 연결하면 저장소로 인식되며 유저가 사용하는 영역이다. 사진과 동영상은 외부 저장소에 저장된다.
```

**메모리 누수**

```
메모리 누수란 메모리가 해제되지 않는 상황이 지속되는 것을 말한다. 메모리 누수가 쌓이면 잘 동작하던 폰이 느려지고 앱이 죽을 수 있다.
```





## 2) 전자액자 구현하기

전자액자 앱은 여러 화면이 좌우로 슬라이드 되는 구조다. 화면은 프래그먼트라는 UI 구성 요소로 작성하고 ViewPager를 사용하여 좌우 슬라이드를 구현한다. 이때 사진 로딩 시 메모리를 관리하고 성능을 향상시키는 데 Glide 라이브러리를 사용한다.

구현 순서

1. 화면을 표시하는 프래그먼트 생성
2. 이미지 로딩에 Glide 라이브러리 사용
3. 화면 슬라이드를 구현하는 ViewPager와 PagerAdapter 작성



### 2-1) 프래그먼트 기초

프래그먼트(Pragment)란 사용자 인터페이스의 모음이다. 프래그먼트 여러 개를 조합하여 액티비티 하나를 구성할 수 있고 한 번 작성한 프래그먼트는재사용할 수 있다.

프래그먼트는 액티비티처럼 독자적인 생명주기를 가지고있다.

![01](https://user-images.githubusercontent.com/49340180/62518844-6b205700-b865-11e9-9370-db0e83d1bd13.PNG)

이 사진은 프래그먼트의 생명주기를 나타낸다. 액티비티에 비해서 훨씬 많은 생명주기 콜백 메서드가 있다. 주로 프래그먼트에 표시할 뷰를 레이아웃 파일로부터 읽어오는 부분은 onCreateView() 메서드이다. 액태비티의 onCreate() 부분이라고 생각하면 된다. 그런데 onCreate() 메서드도 존재하는데 프래그먼트를 생성할 때 인자가 함께 넘어온다면 주로 onCreate() 메서드에서 받아서 변수에 담는다. onCreateView() 메서드에서 완성된 레이아웃 뷰는 생명주기에는 포함되지 않는 onViewCreated() 메서드로 전달되며 이쪽에서 뷰가 완성된 이후에 이벤트 처리 등을 수행한다.

프로젝트에서는 주로 onCreate() , onCreateView(), onViewCreated() 세 가지 콜백 메서드를 사용한다.

나머지 프래그먼트는 언제 호출되고 어떤 작업을 하는지

- onAttach() : 액티비티에 붙을 때 호출. 이때 부터 액티비티의 참조를 사용할 수 있다.
- onCreate() : 프래그먼트가 생성될 때 호출. 아직 레이아웃은 완성되기 전
- onCreateView() : 레이아웃을 생성하기 전에 호출. 완성된 뷰를 반환하게 되는데 아직 레이아웃은 완성되기 전
- onActivityCreated() : 액티비티의 onCreate() 메서드가 수행된 직후에 호출
- onStart() : 프래그먼트가 사용자에게 보여질 때 호출
- onResume() : 사용자와 상호작용하기 시작.
- onPause() : 프래그먼트가 일시 중지이거나 더 이상 사용자와 상호작용 하지 않음
- onStop() : 프래그먼트가 중지
- onDestroyView() : 프래그먼트가 해당 자원을 정리할 수 있도록 한다.
- onDestroy() : 프래그먼트가 파괴될 때 호출
- onDetach() : 프래그먼트가 액티비티에서 완전히 제거될 때 호출



### 2-2) Glide 라이브러리 사용

Glide 라이브러리는 미사용 리소스를 자동으로 해제하고 메모리를 효율적으로 관리해준다. 그리고 이미지를 비동기로 로딩하여 UI의 끊김이 없다.

**첫 번째 방법**

https://github.com/bumptech/glide 에서 최신버전을 확인하고 build.gradle에 추가하기

**두 번째 방법**

직접 build.gradle 파일을 수정하지 않고 안드로이드 스튜디오의 메뉴를 활용하는 것. 

File -> Project Structure -> add 모듈 선택 -> Dependencies 탭 클릭 -> + 기호 클릭 -> Library dependency 클릭 -> glide 검색 -> com.github.bumptech.glide.glide 선택



### 2-3) 액티비티에 ViewPager 추가

뷰페이저는 여러 프래그먼트들을 좌우로 슬라이드하는 뷰다. 뷰페이저를 사용하려면 데이터, 어댑터, 뷰 세 가지가 필요한 어댑터 패턴을 구현해야 한다. 세 가지 개념에 해당하는 것은 다음과 같다.

- 데이터 : 프래그먼트(화면)
- 어댑터 : 프래그먼트를 어느 화면에 표시할 것인지 관리하는 객체
- 뷰 : 뷰페이저



### 2-4) PagerAdapter 작성

ViewPager에 표시할 내용을 정의하려면 어댑터가 필요하다. 어댑터는 아이템의 목록 정보를 가진 객체다. 

프래그먼트를 아이템으로 가지면서 ViewPager에 설정하는 어댑터는 다음 두 가지다.

- FragmentPagerAdapter : 페이지 내용이 영구적일 때 적합. 한 번 로딩한 페이지는 메모리에 보관하기 때문에 빠르다. 그래서 페이지가 많으면 많은 메모리를 사용한다.
- FragmentStatePagerAdapter : 많은 수의 페이지가 있을 때 적합. 보이지 않는 페이지를 메모리에서 제거. 상대적으로 적은 메모리를 차지





## 3) 슬라이드쇼 구현하기

사진이 3초마다 자동으로 슬라이드되는 기능을 추가한다.

구현 내용

1. timer로 3초마다 코드실행
2. runOnUiThread로 timer 내부에서 UI 조작하기





## 4) 마치며

이번 장에서는 자동으로 슬라이드되는 전자액자를 구현했다. 

- 콘텐츠 프로바이더를 사용하면 기기에 저장된 사진 정보를 얻을 수 있다.
- 위험한 권한을 사용할 때는 앱을 실행하는 중에 해당 권한의 사용 허용을 사용자에게 요청해야 한다.
- Anko 라이브러리를 사용하면 다이얼로그를 쉽게 표현한다.
- 프래그먼트는 UI 조각이다. 액티비티에는 여러 프래그먼트를 배치할 수 있고 재사용이 가능하다.
- 이미지를 로딩할 때 메모리와 캐시 관리 및 성능을 고려해 Glide 라이브러리를 사용하는 것이 좋다
- 뷰페이저는 여러 프래그먼트를 좌우로 슬라이드하는 어댑터 패턴을 구현하는 뷰.





















