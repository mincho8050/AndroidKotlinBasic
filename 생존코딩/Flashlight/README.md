# chapter11 Flashlight

난이도 : ★★★

프로젝트명 : Flashlight

기능

- 앱에서 스위치로 플래시를 켜고 끈다
- 위젯을 제공해 앱을 실행하지 않고도 플래시를 켜고 끌 수 있다.

핵심 구성요소

- CameraManager : 플래시를 켜는 기능을 제공하는 클래스
- Service : 화면이 없고 백그라운드에서 실행되는 컴포넌ㅌ,
- AppWidget : 런처에 배치하여 빠르게 앱 기능을 쓸 수 있게 하는 컴포넌트

라이브러리 설정

- Anko : 인텐트, 다이얼로그, 로그 등을 구현하는 데 도움이 되는 라이브러리







## 0) 해법요약

손전등 앱을 앱과 위젯으로 구성한다. 앱과 위젯 모두 손전등을 켜고 끄는 인터페이스만을 제공하고 핵심 기능은 서비스에서 수행한다.

구현 순서

1. 준비하기 : 프로젝트 생성 및 안드로이드 설정
2. 스텝 1 : 손전등 기능 구현
3. 스텝 2 : 액티비티에서 손전등 기능 사용
4. 스텝 3 : 서비스에서 손전등 기능 사용
5. 스텝 4 : 앱 위젯 작성

플래시를 켜는 방법은 안드로이드 6.0 이상에서 제공하는 방법(API 23)이 가장 간단하다. 5.0 미만은 코드가 복잡하다. 공식적으로 켜는 방법은 없고 제조사마다 다른 방법을 이용해야 한다. 예제를 테스트 할 때는 안드로이드 6.0 이상의 기기에서 실행해야 하며 에뮬레이터는 플래시가 없으므로 예제가 동작하지 않는다.





## 1) 손전등 기능 구현

손전등 기능의 핵심은 카메라 플래시를 켜고 끄는 것이다. 이를 위해 CameraManager 클래스를 사용하여 플래시 기능을 제어하는 방법이다. 

- 손전등 기능을 Torch 클래스에 작성하기







## 2) 액티비티에서 손전등 기능 사용하기

작성한 Torch 클래스를 사용하여 플래시를 켜고 끄는 간단한 코드를 액티비티에 작성해서 테스트한다. 화면에는 Switch 하나를 배치하여 말 그대로 플래시를 켜고 끄는 스위치처럼 사용한다.

구현 순서

1. 화면 작성
2. Switch 소개
3. 액티비티에서 손전등 켜기

Switch는 켜거나 끄는 두 가지 생태값을 가지는 버튼 객체이다. 







## 3) 서비스에서 손전등 기능 사용

액티비티에서 플래시 동작을 확인했다. 하지만 플래시를 켜는 데  꼭 액티비티가 필요하진 않다. 앱 실행 없이 위젯을 사용해 플레시를 켜는 기능도 있다. 액티비티가 아닌 서비스에서 조작하면 구현가능하다.

구현 순서

1. 서비스 소개
2. 서비스의 생명주기
3. 서비스로 손전등 기능 옮기기
4. 액티비티에서 서비스를 사용해 손전등 켜기



### 3-1) 서비스 소개

서비스(Service)란 안드로이드 4대 컴포넌트(액티비티-Activity,서비스-Service,콘텐트-Content Provider 제공자,방송 수신자-Broadcast Recevier) 중 하나로 화면이 없고 백그라운드에서 수행하는 작업을 작성하는 컴포넌트이다.

플래시를 켜는 기능에 화면이 꼭 필요하지는 않는다. 액티비티는 단순히 플래시를 켜고 끄는 인터페이스만 제공한다. 이런 경우에는 서비스에서 플래시를 켜고 끄도록 하고 액티비티는 서비스를 호출하는 방법을 사용한다. 플래시 위젯도 서비스를 호출해서 조작할 수 있게 된다.

![01](https://user-images.githubusercontent.com/49340180/62770824-cd33c300-bad6-11e9-8507-1ea9eed5828a.PNG)



> 서비스를 사용하여 수정할 계획도

서비스는 크게 바운드된 서비스와 바운드되지 않은 서비스로 나뉜다. 이번 프로젝트에서는 바운드되지 않은 서비스를 다룬다.





### 3-2) 서비스의 생명주기

서비스는 액티비티와 마찬가지로 생명주기용 콜백 메서드를 가지고 있다. 서비스를 시작하면 onCreate() 메서드가 호출되고 onStartCommand() 메서드가 호출되며 여기서 서비스의 동작을 코드로 작성한다. 서비스가 종료되면 onDestroy() 메서드가 호출된다.

![01](https://user-images.githubusercontent.com/49340180/62770649-631b1e00-bad6-11e9-909b-fa5bf1794bc2.PNG)

> 서비스의 생명주기

- onCreate() : 서비스가 생성될 때 호출되는 콜백 메서드이다. 초기화 등을 수행한다.
- onStartCommand() : 서비스가 액티비티와 같은 다른 컴포넌트로부터 startService() 메서드로 호출되면 불리는 콜백 메서드다. 실행할 작업을 여기에 작성한다.
- onDestroy() : 서비스 내부에서 stopSelf()를 호출하거나 외부에서 stopService()로 서비스를 종료하면 호출된다.







## 4) 앱 위젯 작성

서비스를 사용해 플래시를 켜고 끄게 작성한 다음 앱 위젯을 작성한다. 앱 위젯이란 런처에 배치하여 빠르게 앱 기능을 제공하는 컴포넌트이다. 

에뮬레이터의 런처에는 상단에 날짜와 날씨가 표시되는 위젯이 배치되어있다. 날짜 부분과 날씨 부분을 클릭했을 때 각각 캘린터 앱과 날씨 앱이 실행된다.

손전등 위젯은 클릭하면 앱 실행 없이 곧바로 플래시가 켜진다. (다시 클릭하면 플래시가 꺼진다.)

구현 순서

1. 앱 위젯 추가
2. 앱 위젯이 생성한 코드 살펴보기
3. 앱 위젯 레이아웃 수정
4. 앱 위젯에서 손전등 켜기
5. 앱 위젯 배치
6. 앱 위젯 사용하기





### 4-1) 앱 위젯 추가

프로젝트 창의 패키지명에서 우클릭 또는 안드로이드 스튜디오 메뉴에서 File -> New -> Widget -> App Widget을 클릭한다.

이 창의 항목들에 대한 설명

![01](https://user-images.githubusercontent.com/49340180/62771670-baba8900-bad8-11e9-8fb3-c0c3ef15e287.PNG)









## 5) 마치며

이번 프로젝트에서는 카메라의 플래시를 제어하여 손전등 앱을 만들고 더 나아가 앱 위젯까지 작성했다. 

- CameraManager 객체를 사용하여 카메라와 플래시를 조작할 수 있다. 플래시는 안드로이드 버전별로 API 사용 방법이 변경되었다.
- 서비스는 화면이 없고 백그라운드에서 어떠한 동작을 하는 액티비티와 별개로 동작하는 컴포넌트이다.
- 앱 위젯은 런처에서 특정 인텐트, 서비스, 브로드캐스트를 수행할 수 있다. 플래시를 서비스에 구현하여 앱 위젯에서 이 서비스를 시작하여 플래시를 켜고 끌 수 있다.

